<!DOCTYPE html>
<html lang="lv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Izskaties Dzirdēts | Viktorīnas ar Jāni Začu</title>
<meta name="description" content="Profesionālas viktorīnas privātiem un korporatīviem pasākumiem. 14+ gadu pieredze erudīcijas spēlēs.">

<!-- React & ReactDOM -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Merriweather:wght@300;400;700&family=Oswald:wght@400;600&display=swap" rel="stylesheet">

<style>
:root {
    --primary: #E63946;
    --secondary: #F1FAEE;
    --dark: #1D3557;
    --accent: #FFD93D;
    --text: #2B2D42;
    --light-gray: #EDF2F4;
    --success: #06D6A0;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Merriweather', serif; color: var(--text); line-height: 1.6; background: var(--secondary); overflow-x: hidden; }
html { scroll-behavior: smooth; }

/* Hero */
.hero { position: relative; min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--dark) 0%, #457B9D 100%); padding: 2rem; }
.hero-content { text-align: center; max-width: 900px; color: white; }
.brand-logo { font-family: 'Bebas Neue', sans-serif; font-size: clamp(3rem, 10vw, 7rem); margin-bottom: 1rem; text-shadow: 4px 4px 0 var(--primary); }
.tagline { font-size: clamp(1.2rem, 3vw, 1.8rem); color: var(--accent); margin-bottom: 2rem; }

/* Sections */
section { padding: 5rem 2rem; max-width: 1200px; margin: 0 auto; }
.section-title { font-family: 'Bebas Neue', sans-serif; font-size: clamp(2.5rem, 6vw, 4rem); color: var(--dark); margin-bottom: 1rem; position: relative; display: inline-block; }
.section-title::after { content: ''; position: absolute; bottom: -10px; left: 0; width: 60%; height: 4px; background: var(--primary); }

/* Booking */
.booking-section { background: white; padding: 5rem 2rem; }
.booking-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 3rem; margin-top: 3rem; }
.calendar-wrapper, .booking-form-wrapper { background: white; padding: 2.5rem; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
.booking-form-wrapper { position: sticky; top: 2rem; max-height: calc(100vh - 4rem); overflow-y: auto; }

/* Calendar */
.calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
.nav-btn { background: var(--dark); color: white; border: none; padding: 0.5rem 1rem; cursor: pointer; font-family: 'Oswald', sans-serif; transition: all 0.3s; border-radius: 5px; }
.nav-btn:hover { background: var(--primary); }
.current-month { font-family: 'Oswald', sans-serif; font-size: 1.5rem; min-width: 200px; text-align: center; }
.calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; }
.calendar-day-header { text-align: center; font-family: 'Oswald', sans-serif; color: var(--dark); padding: 1rem 0; font-size: 0.9rem; }
.calendar-day { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid var(--light-gray); cursor: pointer; border-radius: 5px; transition: all 0.3s; }
.calendar-day.disabled, .calendar-day.past { background: #f5f5f5; cursor: not-allowed; opacity: 0.5; }
.calendar-day.selected { background: var(--primary); color: white; border-color: var(--primary); }
.day-number { font-weight: bold; font-size: 1.1rem; }

/* Form */
.form-group { margin-bottom: 1.5rem; }
.form-label { display: block; font-family: 'Oswald', sans-serif; color: var(--dark); margin-bottom: 0.5rem; font-size: 1.1rem; }
.form-input, .form-select, .form-textarea { width: 100%; padding: 0.8rem; border: 2px solid var(--light-gray); border-radius: 5px; font-family: 'Merriweather', serif; font-size: 1rem; transition: border-color 0.3s; }
.form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--primary); }
.submit-btn { width: 100%; padding: 1.2rem; background: var(--primary); color: white; border: none; border-radius: 5px; font-family: 'Oswald', sans-serif; font-size: 1.3rem; cursor: pointer; transition: all 0.3s; text-transform: uppercase; letter-spacing: 1px; }
.submit-btn:hover:not(:disabled) { background: var(--dark); }

/* Responsive */
@media (max-width: 1024px) { .booking-grid { grid-template-columns: 1fr; } .booking-form-wrapper { position: static; max-height: none; } }
</style>
</head>
<body>
<section class="hero">
  <div class="hero-content">
    <div class="brand-logo">Izskaties Dzirdēts</div>
    <div class="tagline">Profesionālas viktorīnas privātiem un korporatīviem pasākumiem</div>
    <p>14+ gadu pieredze erudīcijas spēlēs. Rezervē savu datumu zemāk!</p>
  </div>
</section>

<section class="booking-section">
  <h2 class="section-title">Rezervācijas kalendārs</h2>
  <div id="booking-root"></div>
</section>

<section class="contact-section">
  <h2 class="section-title">Sazinies ar mani</h2>
  <div class="contact-info">
    <p>Email: <a href="mailto:janiszacs@gmail.com">janiszacs@gmail.com</a></p>
    <p>Tālrunis: +371 12345678</p>
  </div>
</section>

<script type="text/babel">
const { useState, useEffect } = React;

// Supabase inicializācija
const supabaseUrl = "https://YOUR_SUPABASE_URL";
const supabaseKey = "YOUR_SUPABASE_KEY";
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

// Kalendāra dati
function BookingApp() {
  const [currentDate, setCurrentDate] = useState(new Date());
  const [selectedDate, setSelectedDate] = useState(null);
  const [availableDates, setAvailableDates] = useState([]);
  const [name, setName] = useState('');
  const [email, setEmail] = useState('');
  const [message, setMessage] = useState('');
  const [loading, setLoading] = useState(false);
  const [success, setSuccess] = useState(false);
  const [error, setError] = useState('');

  useEffect(() => {
    fetchAvailableDates();
  }, [currentDate]);

  async function fetchAvailableDates() {
    const { data, error } = await supabase.from("bookings").select("*");
    if (!error && data) {
      setAvailableDates(data.map(d => new Date(d.date).toDateString()));
    }
  }

  function getMonthDays(date) {
    let year = date.getFullYear();
    let month = date.getMonth();
    let firstDay = new Date(year, month, 1);
    let lastDay = new Date(year, month + 1, 0);
    let days = [];
    let startDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay()-1; // nedēļa sākas pirmdienā

    for(let i=0; i<startDay; i++) days.push(null);
    for(let d=1; d<=lastDay.getDate(); d++) {
      days.push(new Date(year, month, d));
    }
    return days;
  }

  function handlePrevMonth() {
    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));
  }

  function handleNextMonth() {
    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));
  }

  async function handleSubmit(e) {
    e.preventDefault();
    if (!selectedDate) return setError("Izvēlies datumu!");

    // Vienkārša bot aizsardzība
    if(name.toLowerCase().includes("bot") || email.toLowerCase().includes("bot")) {
      return setError("Bot aizsardzība aktivizēta!");
    }

    setLoading(true);
    setError('');
    try {
      const { data, error } = await supabase.from("bookings").insert([
        { date: selectedDate, name, email, message }
      ]);
      if(error) throw error;
      setSuccess(true);
      setName(''); setEmail(''); setMessage(''); setSelectedDate(null);
      fetchAvailableDates();
    } catch(err) {
      setError("❌ Neizdevās nosūtīt rezervāciju. Lūdzu mēģiniet vēlreiz vai sazinieties tieši: janiszacs@gmail.com");
    } finally {
      setLoading(false);
    }
  }

  const monthDays = getMonthDays(currentDate);
  const monthNames = ["Janvāris","Februāris","Marts","Aprīlis","Maijs","Jūnijs","Jūlijs","Augusts","Septembris","Oktobris","Novembris","Decembris"];
  const weekDays = ["P","O","T","C","P","S","S"];

  return (
    <div className="booking-grid">
      <div className="calendar-wrapper">
        <div className="calendar-header">
          <button className="nav-btn" onClick={handlePrevMonth}>❮</button>
          <div className="current-month">{monthNames[currentDate.getMonth()]} {currentDate.getFullYear()}</div>
          <button className="nav-btn" onClick={handleNextMonth}>❯</button>
        </div>
        <div className="calendar-grid">
          {weekDays.map((d,i)=><div key={i} className="calendar-day-header">{d}</div>)}
          {monthDays.map((day, i) => {
            if(!day) return <div key={i} className="calendar-day disabled"></div>;
            const isPast = day < new Date().setHours(0,0,0,0);
            const dayString = day.toDateString();
            const isAvailable = availableDates.includes(dayString);
            return (
              <div 
                key={i} 
                className={`calendar-day ${isPast ? 'past' : ''} ${selectedDate===dayString ? 'selected' : ''}`}
                onClick={()=>!isPast && setSelectedDate(dayString)}
              >
                <div className="day-number">{day.getDate()}</div>
              </div>
            )
          })}
        </div>
      </div>

      <div className="booking-form-wrapper">
        {success ? <div className="success-message">Rezervācija veiksmīgi nosūtīta!</div> : (
        <form onSubmit={handleSubmit}>
          {error && <div className="error-message">{error}</div>}
          <div className="form-group">
            <label className="form-label">Izvēlies datumu</label>
            <input type="text" className="form-input" readOnly value={selectedDate || ''} placeholder="Klikšķini kalendārā"/>
          </div>
          <div className="form-group">
            <label className="form-label">Vārds</label>
            <input className="form-input" value={name} onChange={e=>setName(e.target.value)} required/>
          </div>
          <div className="form-group">
            <label className="form-label">E-pasts</label>
            <input type="email" className="form-input" value={email} onChange={e=>setEmail(e.target.value)} required/>
          </div>
          <div className="form-group">
            <label className="form-label">Ziņa / Komentārs</label>
            <textarea className="form-textarea" value={message} onChange={e=>setMessage(e.target.value)}></textarea>
          </div>
          <button className="submit-btn" type="submit" disabled={loading}>
            {loading ? <span className="loading-spinner"></span> : "Rezervēt"}
          </button>
        </form>
        )}
      </div>
    </div>
  );
}

ReactDOM.render(<BookingApp />, document.getElementById('booking-root'));
</script>
</body>
</html>
